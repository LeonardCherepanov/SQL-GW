
--1. В каких городах больше одного аэропорта?

select city, count(city) 
from airports_data ad
group by 1 --группируем по названию города
having count(city) > 1

--2. В каких аэропортах есть рейсы, выполняемые самолетом с максимальной дальностью перелета? - Подзапрос

--explain analyse 
select distinct ad.airport_name, ad.airport_code 
from flights f
join airports_data ad on ad.airport_code = f.departure_airport -- джойним таблицу с названиями аэропортов
where aircraft_code in
(select aircraft_code from aircrafts_data order by "range" desc limit 1) -- находим самолет с максимальной дальностью полета (Подзапрос)
--group by 1,2

--3. Вывести 10 рейсов с максимальным временем задержки вылета. - Оператор LIMIT

select flight_id, actual_departure - scheduled_departure as delta 
from flights f 
where actual_departure notnull -- фильтруем несостоявшиеся рейсы
order by 2 desc -- фильтруем по времени задержки
limit 10 -- оставляем первые 10 записей (Оператор LIMIT)

--4. Были ли брони, по которым не были получены посадочные талоны? - Верный тип JOIN

select book_ref, ticket_no
from bookings b
left join tickets t using (book_ref)
-- where ticket_no is null